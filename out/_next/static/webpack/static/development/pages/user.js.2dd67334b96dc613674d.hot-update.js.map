{"version":3,"file":"static/webpack/static\\development\\pages\\user.js.2dd67334b96dc613674d.hot-update.js","sources":["webpack:///./pages/user.js"],"sourcesContent":["import { makeStyles } from '@material-ui/core/styles';\r\nimport Table from '@material-ui/core/Table';\r\nimport TableBody from '@material-ui/core/TableBody';\r\nimport TableCell from '@material-ui/core/TableCell';\r\nimport TableHead from '@material-ui/core/TableHead';\r\nimport TableRow from '@material-ui/core/TableRow';\r\nimport Paper from '@material-ui/core/Paper';\r\nimport fetch from 'isomorphic-unfetch';\r\nimport Button from '@material-ui/core/Button';\r\nimport Snackbar from '@material-ui/core/Snackbar';\r\nimport Msg from '../components/Msg';\r\nimport moment from 'moment';\r\nmoment.locale('zh-CN');\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n    root: {\r\n        width: '100%',\r\n        marginTop: theme.spacing(3),\r\n        overflowX: 'auto',\r\n    },\r\n    table: {\r\n        minWidth: 650,\r\n    },\r\n}));\r\n\r\nexport default function User({ users }) {\r\n    const [type, setType] = React.useState('info');\r\n    const [open, setOpen] = React.useState(false);\r\n    const [msg, setMsg] = React.useState('');\r\n\r\n    const classes = useStyles();\r\n\r\n    function handleClose() {\r\n        setOpen(false);\r\n    }\r\n    async function handleDelete(users, id) {\r\n        const res = await fetch(`http://localhost:8080/api/user?id=${id}`, {\r\n            method: 'DELETE',\r\n        });\r\n        const text = await res.text();\r\n        let data = text ? JSON.parse(text) : {};\r\n        if (data.errorCode) {\r\n            setType('error');\r\n            setMsg(data.msg);\r\n            setOpen(true);\r\n        } else {\r\n            let rIndex = users.findIndex(user => user._id === id);\r\n            users.splice(rIndex, 1);\r\n            setType('success');\r\n            setMsg('删除用户成功！');\r\n            setOpen(true);\r\n        }\r\n    }\r\n\r\n    return (\r\n        <React.Fragment>\r\n            <Paper className={classes.root}>\r\n                <Table className={classes.table}>\r\n                    <TableHead>\r\n                        <TableRow>\r\n                            <TableCell>用户 ID</TableCell>\r\n                            <TableCell align='left'>用户名</TableCell>\r\n                            <TableCell align='left'>密码</TableCell>\r\n                            <TableCell align='left'>注册日期</TableCell>\r\n                            <TableCell align='left'>最后一次登录日期</TableCell>\r\n                            <TableCell align='left'>操作</TableCell>\r\n                        </TableRow>\r\n                    </TableHead>\r\n                    <TableBody>\r\n                        {users.map(user => (\r\n                            <TableRow key={user._id}>\r\n                                <TableCell component='th' scope='row'>\r\n                                    {user._id}\r\n                                </TableCell>\r\n                                <TableCell align='left'>{user.usr}</TableCell>\r\n                                <TableCell align='left'>{user.psd}</TableCell>\r\n                                <TableCell align='left'>\r\n                                    {moment(user.createTime).format('lll')}\r\n                                </TableCell>\r\n                                <TableCell align='left'>\r\n                                    {moment(user.updateTime).format('lll')}\r\n                                </TableCell>\r\n                                <TableCell align='left'>\r\n                                    <Button\r\n                                        variant='contained'\r\n                                        color='primary'\r\n                                        onClick={() =>\r\n                                            handleDelete(users, user._id)\r\n                                        }\r\n                                    >\r\n                                        删除\r\n                                    </Button>\r\n                                </TableCell>\r\n                            </TableRow>\r\n                        ))}\r\n                    </TableBody>\r\n                </Table>\r\n            </Paper>\r\n            <Snackbar\r\n                anchorOrigin={{\r\n                    vertical: 'top',\r\n                    horizontal: 'center',\r\n                }}\r\n                open={open}\r\n                autoHideDuration={1000}\r\n                onClose={handleClose}\r\n            >\r\n                <Msg onClose={handleClose} variant={type} message={msg} />\r\n            </Snackbar>\r\n        </React.Fragment>\r\n    );\r\n}\r\n\r\nUser.getInitialProps = async () => {\r\n    const res = await fetch('http://localhost:8080/api/users');\r\n    const json = await res.json();\r\n    return {\r\n        shellTitle: '用户管理',\r\n        pageTitle: '72 Kr | 用户管理',\r\n        layout: 1,\r\n        users: json.data,\r\n    };\r\n};\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AADA;AANA;AAAA;AAWA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AAVA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAUA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AADA;AACA;AAFA;AACA;AADA;AAAA;AACA;AADA;AAIA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAjBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAVA;AAAA;AACA;AA4BA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAAA;AAAA;AAHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAdA;AA8BA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAPA;AAAA;AAAA;AAAA;AAAA;AAAA;AASA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAAA;AACA;AADA;AAEA;AAFA;AAIA;AACA;AACA;AACA;AAJA;AACA;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;A","sourceRoot":""}